@startuml
autonumber

participant Client as "Клиент"
participant Server as "Сервер"
participant CA as "Центр сертификации (CA)"

Client -> Server: ClientHello\n(Поддерживаемые криптографические алгоритмы)

Server -> Client: ServerHello\n(Выбранные алгоритмы)
Server -> Client: Сертификат сервера
Server -> Client: Запрос сертификата клиента

Client -> CA: Проверка сертификата сервера
CA --> Client: Сертификат действителен

Client -> Server: Сертификат клиента

Server -> CA: Проверка сертификата клиента
CA --> Server: Сертификат действителен

Client -> Server: Обмен ключевым материалом (ECDHE)

Client -> Server: Finished
Server -> Client: Finished

note over Client,Server
Выполнена взаимная аутентификация (mTLS).
Сформированы сеансовые ключи
и установлен защищённый канал связи.
end note

@enduml
